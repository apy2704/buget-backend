// This is your Prisma schema file
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model - represents a user account
model User {
  id            String     @id @default(cuid())
  email         String     @unique
  password      String
  name          String?
  avatar        String?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  // Relations
  account       Account?
  transactions  Transaction[]
  expenses      Expense[]
  incomes       Income[]
  investments   Investment[]
  budgets       Budget[]
  cards         Card[]
  savingsGoals  SavingsGoal[]

  @@map("users")
}

// Account model - tracks user's financial account
model Account {
  id            String     @id @default(cuid())
  userId        String     @unique
  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  totalBalance  Decimal    @default(0) @db.Decimal(15, 2)
  totalIncome   Decimal    @default(0) @db.Decimal(15, 2)
  totalExpense  Decimal    @default(0) @db.Decimal(15, 2)
  totalSavings  Decimal    @default(0) @db.Decimal(15, 2)
  totalInvested Decimal    @default(0) @db.Decimal(15, 2)
  
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  @@map("accounts")
}

// Unified Transaction model (includes income, expenses, investments)
model Transaction {
  id            String     @id @default(cuid())
  userId        String
  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title         String
  description   String?
  date          DateTime   @default(now())
  amount        Decimal    @db.Decimal(15, 2)
  type          TransactionType  // 'income' | 'expense' | 'investment'
  category      String
  icon          String?
  paymentMethod String?    // e.g., 'card', 'bank', 'cash'
  
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  @@index([userId])
  @@index([date])
  @@index([type])
  @@map("transactions")
}

// Expense model - detailed expense tracking
model Expense {
  id            String     @id @default(cuid())
  userId        String
  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title         String
  category      String     // Can store as string for flexibility
  amount        Decimal    @db.Decimal(15, 2)
  date          DateTime   @default(now())
  paymentMethod String?    // 'credit_card', 'debit_card', 'cash', 'bank_transfer'
  description   String?
  
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  @@index([userId])
  @@index([date])
  @@index([category])
  @@map("expenses")
}

// Income model - detailed income tracking
model Income {
  id            String     @id @default(cuid())
  userId        String
  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title         String
  source        String     // e.g., 'salary', 'freelance', 'investment', 'bonus'
  amount        Decimal    @db.Decimal(15, 2)
  date          DateTime   @default(now())
  frequency     String?    // 'one_time', 'monthly', 'weekly'
  description   String?
  
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  @@index([userId])
  @@index([date])
  @@map("incomes")
}

// Investment model - track investments
model Investment {
  id            String     @id @default(cuid())
  userId        String
  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title         String
  area          String     // 'stocks', 'crypto', 'mutual_funds', 'real_estate', 'bonds', 'other'
  amount        Decimal    @db.Decimal(15, 2)
  quantity      Decimal?   @db.Decimal(15, 4)  // for stocks, crypto
  purchasePrice Decimal?   @db.Decimal(15, 2)
  currentValue  Decimal?   @db.Decimal(15, 2)
  date          DateTime   @default(now())
  description   String?
  
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  @@index([userId])
  @@index([date])
  @@index([area])
  @@map("investments")
}

// Budget model - tracks budget limits and spending
model Budget {
  id            String     @id @default(cuid())
  userId        String
  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  name          String
  category      String?
  spent         Decimal    @default(0) @db.Decimal(15, 2)
  limit         Decimal    @db.Decimal(15, 2)
  color         String     @default("#10B981")  // Hex color
  icon          String?
  frequency     String     @default("monthly")  // 'weekly', 'monthly', 'yearly'
  month         Int?       // for monthly budgets: 1-12
  year          Int?       // for tracking budget year
  alertThreshold Int       @default(80)  // percentage (0-100)
  
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  @@index([userId])
  @@index([frequency])
  @@map("budgets")
}

// Card model - payment cards
model Card {
  id            String     @id @default(cuid())
  userId        String
  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  name          String
  type          String     // 'debit' or 'credit'
  last4         String     // Last 4 digits
  issuer        String?    // 'Visa', 'Mastercard', etc.
  expiryMonth   Int?
  expiryYear    Int?
  limit         Decimal?   @db.Decimal(15, 2)  // for credit cards
  isDefault     Boolean    @default(false)
  
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  @@index([userId])
  @@map("cards")
}

// Savings Goal model
model SavingsGoal {
  id            String     @id @default(cuid())
  userId        String
  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title         String
  description   String?
  targetAmount  Decimal    @db.Decimal(15, 2)
  currentAmount Decimal    @default(0) @db.Decimal(15, 2)
  deadline      DateTime?
  priority      String     @default("medium")  // 'low', 'medium', 'high'
  status        String     @default("active")  // 'active', 'completed', 'paused'
  category      String?    // 'emergency', 'vacation', 'education', 'home', 'vehicle', 'other'
  color         String     @default("#3B82F6")
  icon          String?
  
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  @@index([userId])
  @@index([status])
  @@map("savings_goals")
}

// Enum for transaction types
enum TransactionType {
  income
  expense
  investment
}
